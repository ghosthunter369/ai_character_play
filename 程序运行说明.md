# AI Character Play 程序运行说明

## 项目概述

AI Character Play 是一个基于 Spring Boot + Vue 3 的智能对话应用，支持语音识别、实时聊天、用户管理等功能。

- **后端技术栈**：Spring Boot 3.5.6 + MyBatis Plus + MySQL + Redis + WebSocket
- **前端技术栈**：Vue 3 + TypeScript + Element Plus + Pinia + Vite
- **AI 服务**：LangChain4j + DashScope API
- **语音服务**：讯飞语音识别

## 注意

请务必开启讯飞开放平台：语音识别（实时语音转写大模型）、语音合成（超拟人语音合成）以及阿里云百炼

## 环境要求

### 基础环境
- **Java**: JDK 21 或更高版本
- **Node.js**: 16.0 或更高版本
- **MySQL**: 8.0 或更高版本
- **Redis**: 6.0 或更高版本

### 开发工具
- **IDE**: IntelliJ IDEA / VS Code
- **数据库管理**: MySQL Workbench

## 数据库配置

### 1. 创建数据库
```sql
CREATE DATABASE aichat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. 导入数据表
执行 `sql/aichat.sql` 文件中的 SQL 语句：
```bash
mysql -u root -p aichat < sql/aichat.sql
```

### 3. 数据库表说明
- `user`: 用户表，存储用户基本信息
- `app`: 应用表，存储 AI 应用配置
- `chat_history`: 聊天记录表，存储对话历史

## 后端配置与启动

### 1. 配置文件说明

#### 主配置文件 `src/main/resources/application.yml`
```yaml
server:
  port: 8123  # 后端服务端口

spring:
  application:
    name: ai-character-play
  profiles:
    active: local  # 激活本地配置

# 讯飞语音识别配置
xunfei:
  app-id: xxx
  access-key-id: xxx
  access-key-secret: xxx
  tts-vcn: x5_lingfeiyi_flow
  tts-audio-encoding: lame
  tts-audio-sampleRate: 24000

# 日志配置
logging:
  level:
    com.character: DEBUG
    org.java_websocket: INFO
```

#### 本地环境配置 `src/main/resources/application-local.yml`
```yaml
spring:
  application:
    name: AiChat
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://xxxx:3306/aichat
    username: xxxx
    password: xxxx
  data:
    redis:
      host: localhost
      port: 6379
      password:
      ttl: 3600
      database: 0
server:
  port: 8123
  servlet:
    context-path: /api
    # springdoc-openapi
springdoc:
  group-configs:
    - group: 'default'
      paths-to-match: '/**'
      packages-to-scan: com.character.controller
# knife4j
knife4j:
  enable: true
  setting:
    language: zh_cn
    # AI
langchain4j:
  open-ai:
    chat-model:
      base-url: https://dashscope.aliyuncs.com/compatible-mode/v1
      api-key: xxxx
      model-name: qwen-plus-2025-07-28
      log-requests: true
      log-responses: true
      max-tokens: 8192
xunfei:
  app-id: xxx
  access-key-id: xxx
  access-key-secret: xxx
  tts-vcn: x5_lingfeiyi_flow
  tts-audio-encoding: lame
  tts-audio-sampleRate: 24000
# 日志配置
logging:
  level:
    com.character: DEBUG
    org.java_websocket: INFO
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"
```

### 2. 必需的配置修改

在启动前，请务必修改以下配置：

#### 数据库配置
```yaml
spring:
  datasource:
    username: root
    password: 你的MySQL密码
```

#### OpenAI API 配置
```yaml
langchain4j:
  open-ai:
    chat-model:
      api-key: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  # 你的 OpenAI API Key
      base-url: https://dashscope.aliyuncs.com/compatible-mode/v1  # 阿里云百炼
```

#### Redis 配置（如果使用）
```yaml
spring:
  data:
    redis:
      password: 你的Redis密码  # 如果 Redis 没有密码可以删除此行
```

### 3. 启动后端服务

#### 方式一：使用 Maven 命令
```bash
# 在项目根目录执行
mvn clean compile
mvn spring-boot:run
```

#### 方式二：使用 IDE
1. 在 IntelliJ IDEA 中打开项目
2. 找到 `src/main/java/com/character/AiChatApplication.java`
3. 右键选择 "Run AiChatApplication"

#### 方式三：打包运行
```bash
mvn clean package -DskipTests
java -jar target/AiChat-0.0.1-SNAPSHOT.jar
```

### 4. 验证后端启动
- 访问 http://localhost:8123
- 访问 Swagger 文档：http://localhost:8123/api/doc.html
- 检查控制台日志，确认数据库连接成功

## 前端配置与启动

### 1. 安装依赖
```bash
cd aichat-vue
npm install
```

### 2. 配置说明

前端主要配置在以下文件中：

#### API 基础地址配置 `aichat-vue/src/services/api.ts`
```typescript
const api = axios.create({
  baseURL: 'http://localhost:8123/api',  # 后端 API 地址
  timeout: 10000
})
```

### 3. 启动前端服务
```bash
cd aichat-vue
npm run dev
```

默认启动在 http://localhost:5173 或 http://localhost:5174

